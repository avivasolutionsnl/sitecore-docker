{
  "Parameters": {
    "SiteName": {
      "Type": "string",
      "Description": "The name of the site to be deployed.",
      "DefaultValue": ""
    },
    "SqlDbPrefix": {
      "Type": "string",
      "Description": "SQL DB Prefix",
      "DefaultValue": ""
    },
    "SqlAdminUser": {
      "Type": "string",
      "Description": "The Sql admin user account to use when installing databases.",
      "DefaultValue": ""
    },
    "SqlAdminPassword": {
      "Type": "string",
      "Description": "The Sql admin password to use when installing databases.",
      "DefaultValue": ""
    },
    "SitecoreDbServer": {
      "Type": "string",
      "Description": "The Sitecore database server name.",
      "DefaultValue": ".\\SQLSERVER"
    },
    "PowershellExtensionsWdpFullPath": {
      "Type": "string",
      "Description": "Powershell Extensions wdp package full path.",
      "DefaultValue": ""
    },
    "SXAFrameworkWdpFullPath": {
      "Type": "string",
      "Description": "SXA Framework wdp package full path.",
      "DefaultValue": ""
    }
  },
  "Variables": {
    "PowershellExtensions.Package.Path": "[parameter('PowershellExtensionsWdpFullPath')]",
    "SXAFramework.Package.Path": "[parameter('SXAFrameworkWdpFullPath')]",
    "Sql.Server": "[parameter('SitecoreDbServer')]",
    "Sql.Database.Core": "[concat(parameter('SqlDbPrefix'), '_Core')]",
    "Sql.Database.Master": "[concat(parameter('SqlDbPrefix'), '_Master')]",
    "Sql.Core.ConnectionString": "[SqlConnectionString(variable('Sql.Server'),variable('Sql.Database.Core'), parameter('SqlAdminUser'), parameter('SqlAdminPassword'))]",
    "Sql.Master.ConnectionString": "[SqlConnectionString(variable('Sql.Server'),variable('Sql.Database.Master'), parameter('SqlAdminUser'), parameter('SqlAdminPassword'))]"
  },
  "Tasks": {
    "InstallPowershellExtensionsWDPModule": {
      "Type": "WebDeploy",
      "Params": {
        "Verb": "Sync",
        "Arguments": {
          "Source": {
            "Package": "[resolvepath(variable('PowershellExtensions.Package.Path'))]"
          },
          "Dest": "Auto",
          "EnableRule": "DoNotDeleteRule",
          "SetParam": [
            {
              "Name": "Application Path",
              "Value": "[parameter('SiteName')]"
            },
            {
              "Name": "Core Admin Connection String",
              "Value": "[variable('Sql.Core.ConnectionString')]"
            },
            {
              "Name": "Master Admin Connection String",
              "Value": "[variable('Sql.Master.ConnectionString')]"
            }
          ]
        }
      }
    },
    "InstallSXAFrameworkWDPModule": {
      "Type": "WebDeploy",
      "Params": {
        "Verb": "Sync",
        "Arguments": {
          "Source": {
            "Package": "[resolvepath(variable('SXAFramework.Package.Path'))]"
          },
          "Dest": "Auto",
          "EnableRule": "DoNotDeleteRule",
          "SetParam": [
            {
              "Name": "Application Path",
              "Value": "[parameter('SiteName')]"
            },
            {
              "Name": "Core Admin Connection String",
              "Value": "[variable('Sql.Core.ConnectionString')]"
            },
            {
              "Name": "Master Admin Connection String",
              "Value": "[variable('Sql.Master.ConnectionString')]"
            }
          ]
        }
      }
    }
  }
}
